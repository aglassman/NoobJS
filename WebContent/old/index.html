
<!DOCTYPE HTML>
<html>
    <head>
        <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>-->
        <!--<script src="/box2d/jquery/js/jquery.easing.1.3.js" type="text/javascript"></script>-->
        <script src="/box2d/jquery/js/jquery-1.7.1.min.js" type="text/javascript"></script>
        <script src="/box2d/js/FunNav.js" type="text/javascript"></script>
        <link href="/box2d/stylesheets/home.css" rel="stylesheet" type="text/css" />
        <!--<link href='http://fonts.googleapis.com/css?family=Russo+One' rel='stylesheet' type='text/css'>
        //<link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>-->
        <!-- libs -->
    	<!--[if IE]><script type="text/javascript" src="lib/excanvas.js"></script><![endif]-->
        <script src="/box2d/lib/prototype-1.6.0.2.js"></script>

    	<!-- box2djs -->
        <script src='/box2d/js/box2d/common/b2Settings.js'></script>
        <script src='/box2d/js/box2d/common/math/b2Vec2.js'></script>
        <script src='/box2d/js/box2d/common/math/b2Mat22.js'></script>
        <script src='/box2d/js/box2d/common/math/b2Math.js'></script>
        <script src='/box2d/js/box2d/collision/b2AABB.js'></script>
        <script src='/box2d/js/box2d/collision/b2Bound.js'></script>
        <script src='/box2d/js/box2d/collision/b2BoundValues.js'></script>
        <script src='/box2d/js/box2d/collision/b2Pair.js'></script>
        <script src='/box2d/js/box2d/collision/b2PairCallback.js'></script>
        <script src='/box2d/js/box2d/collision/b2BufferedPair.js'></script>
        <script src='/box2d/js/box2d/collision/b2PairManager.js'></script>
        <script src='/box2d/js/box2d/collision/b2BroadPhase.js'></script>
        <script src='/box2d/js/box2d/collision/b2Collision.js'></script>
        <script src='/box2d/js/box2d/collision/Features.js'></script>
        <script src='/box2d/js/box2d/collision/b2ContactID.js'></script>
        <script src='/box2d/js/box2d/collision/b2ContactPoint.js'></script>
        <script src='/box2d/js/box2d/collision/b2Distance.js'></script>
        <script src='/box2d/js/box2d/collision/b2Manifold.js'></script>
        <script src='/box2d/js/box2d/collision/b2OBB.js'></script>
        <script src='/box2d/js/box2d/collision/b2Proxy.js'></script>
        <script src='/box2d/js/box2d/collision/ClipVertex.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2Shape.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2ShapeDef.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2BoxDef.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2CircleDef.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2CircleShape.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2MassData.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2PolyDef.js'></script>
        <script src='/box2d/js/box2d/collision/shapes/b2PolyShape.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2Body.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2BodyDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2CollisionFilter.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2Island.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2TimeStep.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2ContactNode.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2Contact.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2ContactConstraint.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2ContactConstraintPoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2ContactRegister.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2ContactSolver.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2CircleContact.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2Conservative.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2NullContact.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2PolyAndCircleContact.js'></script>
        <script src='/box2d/js/box2d/dynamics/contacts/b2PolyContact.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2ContactManager.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2World.js'></script>
        <script src='/box2d/js/box2d/dynamics/b2WorldListener.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2JointNode.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2Joint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2JointDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2DistanceJoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2DistanceJointDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2Jacobian.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2GearJoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2GearJointDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2MouseJoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2MouseJointDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2PrismaticJoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2PrismaticJointDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2PulleyJoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2PulleyJointDef.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2RevoluteJoint.js'></script>
        <script src='/box2d/js/box2d/dynamics/joints/b2RevoluteJointDef.js'></script>

        <script src = '/old/myBox2d.js' type="text/javascript"></script>
    </head>

    <body>
        <div id="main">
            <div id="header">
                <h1>Run This In Chrome!</h1>
            </div>
            <div id="nav">
                <canvas name="canvas" id="canvas" width="800" height="200"></canvas>
            </div>
            <div id="content">
            </div>
        </div>
    </body>
    <script type="text/javascript">
    	Test = function(){};
    	Test.prototype.world;
        window.onload = function() { 
           
        	var test = new Test();
        	test.world = createWorld();
            createGround(test.world	);
            createBox(test.world,60,20,10,10,false);
            createBox(test.world,60,60,10,10,false);
            createBox(test.world,80,40,30,10,false);
            createBox(test.world,100,20,10,10,false);
            createBox(test.world,100,60,10,10,false);
            createCircleBody(60,0,10,test.world);

            var obj = document.getElementById('canvas');
            

            var initialPointx = 0;
            var initialPointy = 0;

            obj.addEventListener('mousedown', function(event) {
              console.debug("Down: " + event.offsetX + " " + event.offsetY);
              initialPointx = event.offsetX;
              initialPointy = event.offsetY;
            }, false);


            obj.addEventListener('mouseup', function(event) {
              console.debug("UP: " + event.offsetX + " " + event.offsetY);
              if(Math.abs(initialPointx - event.offsetX) > 10 || Math.abs(initialPointy - event.offsetY) > 10)
              {
                console.debug("square");
                var width = Math.abs(initialPointx - event.offsetX)/2;
                var height = Math.abs(initialPointy - event.offsetY)/2;
                createBox(test.world,initialPointx+(width),initialPointy+(height),width,height,false);
              }
              else
              {
                console.debug("circle");
                createCircleBody(event.offsetX,event.offsetY,10,test.world);
               }
            }, false);



            var timeStep = 1.0/60;
			var iteration = 1;
			
			var c = document.getElementById("canvas");
	    	var ctx = c.getContext("2d");
            var rot=.00000001;
            
            (function() {
            	  var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
            	                              window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
            	  window.requestAnimationFrame = requestAnimationFrame;
            	})();
            
            var prevElapsed;
            
			(function loop(elapsed){
				
				prevElapsed = prevElapsed || elapsed;
				
				var stepTime = (elapsed - prevElapsed)/1000;
				prevElapsed = elapsed;
				//console.log(stepTime);
				test.world.Step(1/60, iteration);
	            
	            ctx.clearRect(0,0,800,200);
	    		ctx.beginPath();
	    		for (var b = test.world.m_bodyList; b; b = b.m_next) {
					for (var s = b.GetShapeList(); s != null; s = s.GetNext()) {

                        switch (s.m_type) {
                            case b2Shape.e_circleShape:
                            {
                                drawPerson(ctx,s.m_position.x,s.m_position.y,s.m_body.m_rotation);
                                break;
                            }
                            case b2Shape.e_polyShape:
                            {
                                var poly = s;
                                var tV = b2Math.AddVV(poly.m_position, b2Math.b2MulMV(poly.m_R, poly.m_vertices[0]));
                                ctx.moveTo(tV.x, tV.y);
                                for (var i = 0; i < poly.m_vertexCount; i++) {
                                    var v = b2Math.AddVV(poly.m_position, b2Math.b2MulMV(poly.m_R, poly.m_vertices[i]));
                                    ctx.lineTo(v.x, v.y);
                                }
                                ctx.lineTo(tV.x, tV.y);
                                ctx.strokeStyle = "blue";
                                ctx.lineWidth = 2;
                                ctx.fill();
                                ctx.stroke();
                                break;
                            }
                        }
					}

					
				}
	    		requestAnimationFrame(loop);
			})();
			
			
        };

        function drawPerson(ctx,x,y,r)
        {
        	//console.log(x,y);
            ctx.save();
            ctx.translate(x,y);
            ctx.rotate(r);
            ctx.beginPath();
            ctx.arc(0,0,10,0,Math.PI*2,true);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(0,-5,5,0,Math.PI*2,true);
            ctx.moveTo(0,0);
            ctx.lineTo(0,5);
            ctx.moveTo(-5,3);
            ctx.lineTo(5,3);
            ctx.moveTo(0,5);
            ctx.lineTo(-5,10);
            ctx.moveTo(0,5);
            ctx.lineTo(5,10);
            //ctx.arc(200,50,20,0,Math.PI*2,true);
            ctx.stroke();
            ctx.restore();
        }
    </script>

</html>